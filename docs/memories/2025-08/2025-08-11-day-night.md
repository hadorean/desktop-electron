Day/Night Settings Implementation Plan (No Migration)

    1. Data Structure Changes

    Update Types (pkg/shared/src/types/settings.ts):

    - Create DayNightScreenSettings interface with day and night properties
    - Update UserSettings.screens to use new structure
    - Add isNightMode property to track current day/night state per screen

    New Structure:

    interface DayNightScreenSettings {
      day: Partial<ScreenSettings>
      night: Partial<ScreenSettings>
    }

    interface UserSettings {
      shared: ScreenSettings
      screens: Record<string, DayNightScreenSettings>
    }

    2. Settings Store Updates (pkg/shared/src/stores/settingsStore.ts)

    New Stores:

    - Add currentDayNight writable store ('day' | 'night') per screen
    - Update localSettings derived store to merge: shared ‚Üí screen.day ‚Üí screen.night
     (if night mode)
    - Add isNightMode derived store for current screen
    - Update updateLocalSettings to target correct day/night sub-settings

    Settings Merge Logic:

    1. Start with shared settings
    2. Override with screen.day settings
    3. If night mode: override with screen.night settings

    3. UI Component Updates

    ScreenSwitcher (pkg/shared/src/components/settings/ScreenSwitcher.svelte):

    - Replace edit button (‚úèÔ∏è) with day/night toggle (‚òÄÔ∏è/üåô)
    - Show current day/night state for active screen
    - Add toggle function to switch between day/night modes for current screen
    - Update tab styling to indicate day/night state

    Visual Design:

    - Day mode: ‚òÄÔ∏è icon, normal colors
    - Night mode: üåô icon, dimmed/cool colors
    - Toggle affects only the currently selected screen

    4. Implementation Details

    Day/Night State Management:

    - Each screen maintains its own day/night state independently
    - Switching screens preserves each screen's day/night mode
    - Settings changes apply to the current screen's current day/night mode

    Default Behavior:

    - New screens start in day mode with empty day/night settings
    - Empty settings fall back to shared settings
    - UI updates reflect current screen's current day/night mode

    5. Implementation Order:

    1. Update types and interfaces
    2. Update settings store logic and derived stores
    3. Modify ScreenSwitcher UI component
    4. Update settings update functions to target day/night correctly
    5. Test new functionality

    This approach starts fresh without migration complexity, allowing users to
    configure day/night settings from scratch.

## Complete Implementation Guide for Next Agent

### üìã All Steps TODO:

#### 1. Update Types (`pkg/shared/src/types/settings.ts`):

**Add new types and interfaces:**
```typescript
export type DayNightMode = 'day' | 'night'

export interface DayNightScreenSettings {
	day: Partial<ScreenSettings>
	night: Partial<ScreenSettings>
}
```

**Update UserSettings interface:**
```typescript
// Change this:
export interface UserSettings {
	lastModified?: string 
	shared: ScreenSettings
	screens: Record<string, Partial<ScreenSettings>>  // OLD
}

// To this:
export interface UserSettings {
	lastModified?: string 
	shared: ScreenSettings
	screens: Record<string, DayNightScreenSettings>  // NEW
}
```

**Add default constant:**
```typescript
export const DefaultDayNightSettings: DayNightScreenSettings = {
	day: {},
	night: {}
}
```

#### 2. Update Settings Store (`pkg/shared/src/stores/settingsStore.ts`):

**A) Add imports:**
```typescript
import type { ScreenSettings, UserSettings, SettingsButtonPosition, DayNightMode, DayNightScreenSettings } from '../types'
import { DefaultScreenSettings, DefaultUserSettings, DefaultDayNightSettings } from '../types'
```

**B) Add day/night state management after allSettings:**
```typescript
// Track day/night mode per screen
const dayNightModes = writable<Record<string, DayNightMode>>({})

// Current day/night mode for the active screen
export const currentDayNightMode = derived(
	[dayNightModes, currentScreen],
	([modes, screen]) => modes[screen] || 'day'
)

// Derived store to check if current screen is in night mode
export const isNightMode = derived(currentDayNightMode, (mode) => mode === 'night')

// Function to toggle day/night mode
export function toggleDayNightMode(screenId?: string): void {
	const targetScreen = screenId || get(currentScreen)
	dayNightModes.update((modes) => ({
		...modes,
		[targetScreen]: modes[targetScreen] === 'night' ? 'day' : 'night'
	}))
}
```

**C) Update getScreenSettings function:**
```typescript
// Replace existing getScreenSettings with:
// Return the day/night settings for a given screen id
export function getScreenDayNightSettings(id: string): DayNightScreenSettings {
	const value = get(allSettings)
	return value.screens[id] ?? DefaultDayNightSettings
}

// Return the merged settings for a given screen id and mode
export function getScreenSettings(id: string, mode: DayNightMode = 'day'): Partial<Settings> {
	const screenSettings = getScreenDayNightSettings(id)
	return screenSettings[mode] ?? {}
}
```

#### 3. Update Settings Store Implementation:

**D) Update localSettings derived store:**
```typescript
// Replace current localSettings with:
export const localSettings = derived(
  [allSettings, currentScreen, currentDayNightMode], 
  ([all, screen, dayNightMode]) => {
    const screenSettings = all.screens[screen] ?? DefaultDayNightSettings
    const daySettings = screenSettings.day ?? {}
    const nightSettings = screenSettings.night ?? {}
    
    // Merge: shared ‚Üí screen.day ‚Üí screen.night (if night mode)
    return {
      ...all.shared,
      ...daySettings,
      ...(dayNightMode === 'night' ? nightSettings : {})
    }
  }
)
```

**E) Update settings update functions:**
```typescript
// Replace existing updateLocalSettings with:
export function updateLocalSettings(settings: (current: Partial<Settings>) => Partial<Settings>): void {
  const screen = get(currentScreen) || defaultScreenId
  const mode = get(currentDayNightMode)
  
  allSettings.update((value) => {
    const screenSettings = value.screens[screen] ?? DefaultDayNightSettings
    const currentModeSettings = screenSettings[mode] ?? {}
    const updatedSettings = settings(currentModeSettings)
    
    return {
      ...value,
      screens: {
        ...value.screens,
        [screen]: {
          ...screenSettings,
          [mode]: updatedSettings
        }
      }
    }
  })
}

// Replace existing updateLocalSettingsSilent with:
export function updateLocalSettingsSilent(settings: (current: Partial<Settings>) => Partial<Settings>): void {
  preventServerSync = true
  try {
    updateLocalSettings(settings)
  } finally {
    Promise.resolve().then(() => {
      preventServerSync = false
    })
  }
}
```

#### 4. Update ScreenSwitcher Component:

**File:** `pkg/shared/src/components/settings/ScreenSwitcher.svelte`

**Key Changes:**
- Import: `isNightMode, toggleDayNightMode, currentDayNightMode`
- Replace edit button section (lines ~152-160) with day/night toggle
- Remove edit mode logic (editMode, renamingScreen, etc.)
- Add day/night toggle styling

**Replace edit controls section:**
```svelte
<!-- Day/Night toggle (replaces edit controls) -->
<div class="daynight-controls">
  <Button 
    variant="ghost" 
    size="sm" 
    onclick={() => toggleDayNightMode()} 
    class="daynight-toggle-btn"
    title={$isNightMode ? 'Switch to Day Mode' : 'Switch to Night Mode'}
  >
    {$isNightMode ? 'üåô' : '‚òÄÔ∏è'}
  </Button>
</div>
```

**Add CSS:**
```css
.daynight-controls {
  display: flex;
  align-items: center;
}

:global(.daynight-toggle-btn) {
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8) !important;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

:global(.daynight-toggle-btn:hover) {
  transform: scale(1.1);
}
```

#### 5. Export New Functions:

**File:** `pkg/shared/src/stores/index.ts`

Add to exports:
```typescript
currentDayNightMode,
isNightMode, 
toggleDayNightMode,
getScreenDayNightSettings
```

### ‚ö†Ô∏è Critical Notes:
1. **Breaking Changes**: The UserSettings interface changes from `Record<string, Partial<ScreenSettings>>` to `Record<string, DayNightScreenSettings>` 
2. **All existing functionality must remain working** - this is critical
3. **No migration needed** - new screens start with empty day/night settings that fall back to shared
4. **Test thoroughly** - this affects core settings functionality
5. **Socket sync must still work** - the new structure needs to serialize/deserialize properly

### üß™ Testing Checklist:
- [ ] Screen switching preserves day/night mode
- [ ] Settings changes apply to correct day/night mode  
- [ ] Day/night toggle works per screen
- [ ] Fallback to shared settings works
- [ ] Socket sync still works correctly
- [ ] Validation still works with new structure
